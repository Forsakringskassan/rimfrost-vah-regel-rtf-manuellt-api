asyncapi: 3.0.0
info:
  title: Regel - Rätt till VAH-försäkring (manuell)
  version: 1.0.0
  description: Manuell regel för att kontrollera om en person har rätt till Vård av husdjur.

channels:
  vah.rtf.manuell.requests:
    address: vah.rtf.manuell.requests
    messages:
      VahRtfManuellRequestMessage:
        $ref: "#/components/messages/VahRtfManuellRequestMessage"

  vah.rtf.manuell.responses:
    address: vah.rtf.manuell.responses
    messages:
      VahRtfManuellResponseMessage:
        $ref: "#/components/messages/VahRtfManuellResponseMessage"

operations:
  onVahRtfManuellRequest:
    action: receive
    summary: Tillämpar regeln och kontrollerar om personen har rätt till Vård av husdjur.
    channel:
      $ref: "#/channels/vah.rtf.manuell.requests"
    reply:
      address:
        description: Resultatet skickas tillbaka till källan.
        location: "$message.header#/replyTo"
      channel:
        $ref: "#/channels/vah.rtf.manuell.responses"

components:
  schemas:
    Parameterdata:
      type: object
      required:
        - id
      properties:
        id:
          type: string
          description: Unikt ID som identifierar data objektet
      additionalProperties: true
      description: Parameterdata i valfritt format. Backend äger strukturen

    VahRtfManuellRequestMessageHeaders:
      type: object
      properties:
        replyTo:
          type: string
          description: Topic där response ska skickas
        correlationId:
          type: string
          description: Unikt ID som kopplar ihop request & response

    VahRtfManuellRequestMessageData:
      type: object
      required:
        - id
      properties:
        id:
          type: string
          description: Unikt ID som identifierar processinstansen
        version:
          type: string
          description: Versionen av processflödet som har skickat requestet
        parameterdata:
          $ref: '#/components/schemas/Parameterdata'

    VahRtfManuellResponseMessageHeaders:
      type: object
      properties:
        correlationId:
          type: string
          description: Unikt ID som kopplar ihop request & response

    VahRtfManuellResponseMessageData:
      type: object
      required:
        - processId
        - id
      properties:
        id:
          type: string
          description: Unikt ID som identifierar regeln
        version:
          type: string
          description: Versionen av regeln som har utförts
        process_id:
          type: string
          description: Unikt ID som identifierar processinstansen
        utforar_id:
          type: string
          description: Unikt ID som identifierar utföraren
        utford_tid:
          type: string
          description: DateTime av när uppgiften utfördes i ISO 8601 format
        status:
          type: string
          description: Status av uppgiften
        fssa:
          type: string
          description: FSSÄ-information till kunden
        regelutfall:
          type: object
          $ref: '#/components/schemas/Regelutfall'

    Regelutfall:
      type: object
      required:
        - typ
        - varde
      properties:
        typ:
          type: object
          description: Typen av objekt som utfallet är
        value:
          type: string
          description: Värdet av objektet som utfallet är av

  messages:
    VahRtfManuellRequestMessage:
      headers:
        $ref: "#/components/schemas/VahRtfManuellRequestMessageHeaders"
      payload:
        title: VahRtfManuellRequestMessagePayload
        allOf:
          - $ref: "kogito-cloudevent.yaml#/components/schemas/KogitoCloudEvent"
          - type: object
            properties:
              data:
                $ref: "#/components/schemas/VahRtfManuellRequestMessageData"

    VahRtfManuellResponseMessage:
      headers:
        $ref: "#/components/schemas/VahRtfManuellResponseMessageHeaders"
      payload:
        title: VahRtfManuellResponseMessagePayload
        allOf:
          - $ref: "kogito-cloudevent.yaml#/components/schemas/KogitoCloudEvent"
          - type: object
            properties:
              data:
                $ref: "#/components/schemas/VahRtfManuellResponseMessageData"

